import{b as g,Q as w}from"./QCard.e64c1d35.js";import{f as Q,e as k,Q as P,h as v,i as x}from"./session-store.c44f5332.js";import{r as p,o as A,z as B,A as N,B as l,C as a,M as S,N as U,H as o,O as y}from"./index.570487fd.js";import{Q as E}from"./QCardActions.c6d51862.js";import{Q as M}from"./QPage.2fc0a31a.js";import"./use-id.420ddb4e.js";const G=Object.assign({name:"SettingsPage"},{__name:"SettingsPage",setup(j){const u=Q(),n=k(),d=p(0),m=p(0),f=p(n.name),s=p(!1);async function C(){await n.updateName(f.value),await u.saveSettings({pricePerCigarette:d.value,cigarettesPerDay:m.value}),y.create({message:"Einstellungen gespeichert!",color:"primary"})}function V(){s.value=!0}async function h(){await u.clearSettings(),await n.clearSessions(),await b(),localStorage.clear(),y.create({message:"Alle Daten werden gel\xF6scht!",color:"red",spinner:!0}),s.value=!1,setTimeout(()=>{window.location.reload()},1e3)}async function b(){if(n.name){await u.initSettings();const i=await u.fetchSettings();d.value=i.pricePerCigarette,m.value=i.cigarettesPerDay}}async function D(){const{sessions:i}=await n.updateSessions(),t=`data:text/csv;charset=utf-8,${[["Datum","Stimulus","Grund"],...i.map(r=>[r.date,r.stimulus,r.reason])].map(r=>r.join(",")).join(`
`)}`,e=encodeURI(t),c=document.createElement("a");c.setAttribute("href",e),c.setAttribute("download","gerauchte_zigaretten.csv"),document.body.appendChild(c),c.click()}return A(async()=>{await b()}),(i,t)=>(B(),N(M,{class:"q-pa-md"},{default:l(()=>[a(w,null,{default:l(()=>[a(g,null,{default:l(()=>t[5]||(t[5]=[S("div",{class:"text-h6"},"Einstellungen",-1)])),_:1}),a(g,null,{default:l(()=>[a(P,{class:"q-gutter-md",onSubmit:U(C,["prevent"])},{default:l(()=>[a(v,{filled:"",label:"Username",modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),rules:[e=>e&&e.length>0||"Name wird ben\xF6tigt!"],hint:"\xC4nderungen f\xFChren zu anderen Daten, da sie mit dem Namen verkn\xFCpft sind."},null,8,["modelValue","rules"]),a(v,{filled:"",type:"number",label:"Preis pro Zigarette (in \u20AC)",modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value=e),rules:[e=>e&&e>0||"Preis muss gr\xF6\xDFer als 0 sein!"]},null,8,["modelValue","rules"]),a(v,{filled:"",type:"number",label:"Zigaretten pro Tag (in St\xFCck)",hint:"Gew\xFCnschtes Limit f\xFCr Erinnerungen",modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),rules:[e=>e&&e>=0||"Zahl muss gr\xF6\xDFer oder gleich 0 sein!"]},null,8,["modelValue","rules"]),a(o,{label:"Speichern",color:"primary",type:"submit"}),a(o,{label:"Export als CSV",color:"primary",onClick:D}),a(o,{label:"Alle Daten l\xF6schen",color:"negative",onClick:V})]),_:1})]),_:1})]),_:1}),a(x,{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=e=>s.value=e),persistent:""},{default:l(()=>[a(w,null,{default:l(()=>[a(g,null,{default:l(()=>t[6]||(t[6]=[S("div",{class:"text-h6"},"Best\xE4tigung",-1)])),_:1}),a(g,null,{default:l(()=>t[7]||(t[7]=[S("div",null,"Bist du sicher, dass du alle Daten l\xF6schen m\xF6chtest?",-1)])),_:1}),a(E,{align:"right"},{default:l(()=>[a(o,{label:"Abbrechen",color:"grey",onClick:t[3]||(t[3]=e=>s.value=!1)}),a(o,{label:"L\xF6schen",color:"negative",onClick:h})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{G as default};
